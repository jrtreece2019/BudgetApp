@page "/transactions"

<PageTitle>All Transactions</PageTitle>

<div class="transactions-page">
    <PageHeader Title="All Transactions" OnBack="GoBack">
        <Actions>
            <button class="export-btn" @onclick="ExportTransactions" title="Export CSV">üì•</button>
        </Actions>
    </PageHeader>

    <!-- Search & Filters -->
    <div class="filters-section">
        <div class="search-box">
            <span class="search-icon">üîç</span>
            <input type="text" 
                   class="search-input" 
                   placeholder="@(SearchAllMonths ? "Search all transactions..." : "Search transactions...")"
                   value="@SearchQuery"
                   @oninput="OnSearchInput" />
            @if (!string.IsNullOrEmpty(SearchQuery))
            {
                <button class="clear-btn" @onclick="ClearSearch">‚úï</button>
            }
        </div>

        <div class="filter-row">
            <select class="filter-select" @bind="SelectedCategoryId">
                <option value="0">All Categories</option>
                <option value="-1">üí∞ Income</option>
                @foreach (var category in Categories)
                {
                    <option value="@category.Id">@category.Icon @category.Name</option>
                }
            </select>
        </div>

        <div class="search-all-toggle" @onclick="ToggleSearchAllMonths">
            <span class="toggle-label">Search all months</span>
            <div class="mini-toggle @(SearchAllMonths ? "on" : "")">
                <div class="mini-toggle-knob"></div>
            </div>
        </div>
    </div>

    @if (!SearchAllMonths)
    {
        <MonthNavigator CurrentDate="CurrentDate" OnPreviousMonth="PreviousMonth" OnNextMonth="NextMonth" />
    }

    <!-- Summary -->
    <div class="summary-row">
        <div class="summary-item">
            <span class="summary-label">Expected</span>
            <span class="summary-value">@ExpectedIncome.ToString("C0")</span>
        </div>
        <div class="summary-item">
            <span class="summary-label">Received</span>
            <span class="summary-value income">@ActualIncome.ToString("C0")</span>
            <span class="summary-detail">@PaycheckCount paycheck@(PaycheckCount != 1 ? "s" : "")</span>
        </div>
        <div class="summary-item">
            <span class="summary-label">Spent</span>
            <span class="summary-value expense">@TotalExpenses.ToString("C0")</span>
        </div>
        <div class="summary-item">
            <span class="summary-label">Remaining</span>
            <span class="summary-value @(NetAmount >= 0 ? "income" : "expense")">@NetAmount.ToString("C0")</span>
        </div>
    </div>

    <!-- Transactions List -->
    <div class="section">
        @if (FilteredTransactions.Any())
        {
            <div class="section-header">
                <span class="section-title">@FilteredTransactions.Count transactions</span>
            </div>
            <div class="transaction-list">
                @foreach (var transaction in FilteredTransactions)
                {
                    var txnId = transaction.Id;
                    var category = Categories.FirstOrDefault(c => c.Id == transaction.CategoryId);
                    var isIncome = transaction.Type == TransactionType.Income;

                    <TransactionListItem
                        Icon="@(category?.Icon ?? "üí∞")"
                        IconColor="@(category?.Color ?? "#6B7280")"
                        Description="@transaction.Description"
                        Date="@transaction.Date"
                        Amount="@transaction.Amount"
                        IsIncome="@isIncome"
                        OnClick="() => EditTransaction(txnId)">
                        <Actions>
                            <button class="delete-btn" @onclick="() => ConfirmDeleteTransaction(txnId)" @onclick:stopPropagation="true">
                                üóëÔ∏è
                            </button>
                        </Actions>
                    </TransactionListItem>
                }
            </div>
        }
        else
        {
            <EmptyState Icon="üìã" Message="No transactions found">
                @if (!string.IsNullOrEmpty(SearchQuery) || SelectedCategoryId != 0)
                {
                    <button class="clear-filters-btn" @onclick="ClearFilters">Clear filters</button>
                }
            </EmptyState>
        }
    </div>

    <div class="bottom-spacer"></div>

    <FloatingActionButton OnClick="AddTransaction" />

    <ConfirmDialog IsVisible="ShowDeleteConfirm"
                   Title="Delete Transaction"
                   Message="Are you sure you want to delete this transaction? This cannot be undone."
                   ConfirmText="Delete"
                   IsDanger="true"
                   OnConfirm="DeleteTransaction"
                   OnCancel="CancelDelete" />
</div>
