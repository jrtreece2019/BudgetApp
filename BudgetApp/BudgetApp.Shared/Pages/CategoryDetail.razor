@page "/category/{CategoryId:int}"
@page "/category/{CategoryId:int}/{Month:int}/{Year:int}"

<PageTitle>@(Category?.Name ?? "Category")</PageTitle>

<div class="category-detail">
    <PageHeader Title="@(Category?.Name ?? "Category")" OnBack="GoBack" />

    @if (Category != null)
    {
        <div class="summary-card" style="background: linear-gradient(135deg, @Category.Color 0%, @AdjustColor(Category.Color) 100%);">
            <div class="summary-icon">@Category.Icon</div>
            <div class="summary-stats">
                <div class="stat-row">
                    <span class="stat-label">Spent</span>
                    <span class="stat-value">@TotalSpent.ToString("C2")</span>
                </div>
                <div class="stat-row editable" @onclick="StartEditingBudget">
                    <span class="stat-label">
                        Budget <span class="edit-hint">✎</span>
                        @if (!IsBudgetCustom)
                        {
                            <span class="default-badge">default</span>
                        }
                    </span>
                    @if (IsEditingBudget)
                    {
                        <div class="budget-edit" @onclick:stopPropagation="true">
                            <span class="currency-prefix">$</span>
                            <input type="number"
                                   class="budget-input"
                                   @bind="EditBudgetAmount"
                                   @bind:event="oninput"
                                   step="1"
                                   min="0" />
                            <button class="save-budget-btn" @onclick="SaveBudget">✓</button>
                            <button class="cancel-budget-btn" @onclick="CancelEditBudget">✕</button>
                            @if (IsBudgetCustom)
                            {
                                <button class="reset-budget-btn" @onclick="ResetBudgetToDefault" title="Reset to default">↺</button>
                            }
                        </div>
                    }
                    else
                    {
                        <span class="stat-value">@Budget.ToString("C2")</span>
                    }
                </div>
                <div class="progress-container">
                    <div class="progress-bar" style="width: @ProgressPercentage%"></div>
                </div>
                <div class="stat-row remaining">
                    <span class="stat-label">Remaining</span>
                    <span class="stat-value @(Remaining < 0 ? "negative" : "")">@Remaining.ToString("C2")</span>
                </div>
            </div>
        </div>

        <MonthNavigator CurrentDate="CurrentDate" OnPreviousMonth="PreviousMonth" OnNextMonth="NextMonth" />

        <div class="section">
            <div class="section-header">
                <span class="section-title">Transactions (@Transactions.Count)</span>
            </div>

            @if (Transactions.Any())
            {
                <div class="transaction-list">
                    @foreach (var transaction in Transactions)
                    {
                        var txnId = transaction.Id;
                        var isIncome = transaction.Type == TransactionType.Income;

                        <TransactionListItem Icon="@Category.Icon"
                                             IconColor="@Category.Color"
                                             Description="@transaction.Description"
                                             Date="transaction.Date"
                                             Amount="transaction.Amount"
                                             IsIncome="isIncome"
                                             OnClick="() => EditTransaction(txnId)">
                            <Actions>
                                <button class="delete-btn" @onclick="() => DeleteTransaction(txnId)" @onclick:stopPropagation="true">✕</button>
                            </Actions>
                        </TransactionListItem>
                    }
                </div>
            }
            else
            {
                <EmptyState Icon="@Category.Icon" Message="No transactions this month" />
            }
        </div>
    }

    <div class="bottom-spacer"></div>

    <FloatingActionButton Label="@("Add " + Category?.Name)" OnClick="AddTransaction" />
</div>
