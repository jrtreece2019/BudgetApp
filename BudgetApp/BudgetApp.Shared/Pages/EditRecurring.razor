@page "/recurring/add"
@page "/recurring/edit/{RecurringId:int}"

<PageTitle>@(IsEditing ? "Edit" : "Add") Recurring</PageTitle>

<div class="edit-recurring">
    <PageHeader Title="@((IsEditing ? "Edit" : "Add") + " Recurring")" OnBack="GoBack">
        <Actions>
            @if (IsEditing)
            {
                <button class="delete-btn" @onclick="ConfirmDelete">üóëÔ∏è</button>
            }
        </Actions>
    </PageHeader>

    <!-- Transaction Type Toggle -->
    <div class="type-toggle">
        <button class="type-btn @(IsExpense ? "active" : "")" @onclick="() => IsExpense = true">
            Expense
        </button>
        <button class="type-btn @(!IsExpense ? "active income" : "")" @onclick="() => IsExpense = false">
            Income
        </button>
    </div>

    <!-- Amount Input -->
    <div class="amount-section">
        <span class="currency-symbol">$</span>
        <input type="number" 
               class="amount-input" 
               placeholder="0.00" 
               step="0.01" 
               min="0"
               @bind="Amount" 
               @bind:event="oninput" />
    </div>

    <!-- Form Fields -->
    <div class="form-section">
        <!-- Description -->
        <div class="form-field">
            <label class="field-label">Description</label>
            <input type="text" 
                   class="field-input" 
                   placeholder="e.g., Netflix, Rent, Salary"
                   @bind="Description" />
        </div>

        <!-- Category (only for expenses) -->
        @if (IsExpense)
        {
            <div class="form-field">
                <label class="field-label">Category</label>
                <div class="category-grid">
                    @foreach (var category in Categories)
                    {
                        <button type="button"
                                class="category-chip @(SelectedCategoryId == category.Id ? "selected" : "")"
                                style="@(SelectedCategoryId == category.Id ? $"background-color: {category.Color}; border-color: {category.Color};" : "")"
                                @onclick="() => SelectedCategoryId = category.Id">
                            <span class="chip-icon">@category.Icon</span>
                            <span class="chip-name">@category.Name</span>
                        </button>
                    }
                </div>
            </div>
        }
        else
        {
            <div class="income-hint">
                <span class="hint-icon">üí°</span>
                <span class="hint-text">Set up a recurring income like salary, side gig, or freelance work</span>
            </div>
        }

        <!-- Frequency -->
        <div class="form-field">
            <label class="field-label">Frequency</label>
            <div class="frequency-options">
                <button type="button" class="freq-btn @(Frequency == RecurrenceFrequency.Weekly ? "active" : "")"
                        @onclick="() => Frequency = RecurrenceFrequency.Weekly">
                    Weekly
                </button>
                <button type="button" class="freq-btn @(Frequency == RecurrenceFrequency.Biweekly ? "active" : "")"
                        @onclick="() => Frequency = RecurrenceFrequency.Biweekly">
                    Biweekly
                </button>
                <button type="button" class="freq-btn @(Frequency == RecurrenceFrequency.Monthly ? "active" : "")"
                        @onclick="() => Frequency = RecurrenceFrequency.Monthly">
                    Monthly
                </button>
                <button type="button" class="freq-btn @(Frequency == RecurrenceFrequency.Yearly ? "active" : "")"
                        @onclick="() => Frequency = RecurrenceFrequency.Yearly">
                    Yearly
                </button>
            </div>
        </div>

        <!-- Day of Month (for monthly) -->
        @if (Frequency == RecurrenceFrequency.Monthly)
        {
            <div class="form-field">
                <label class="field-label">Day of Month</label>
                <select class="field-input" @bind="DayOfMonth">
                    @for (int i = 1; i <= 31; i++)
                    {
                        <option value="@i">@DateHelpers.GetOrdinal(i)</option>
                    }
                </select>
            </div>
        }

        <!-- Start Date -->
        <div class="form-field">
            <label class="field-label">Start Date</label>
            <input type="date" 
                   class="field-input" 
                   @bind="StartDate" />
        </div>

        <!-- Active Toggle -->
        @if (IsEditing)
        {
            <div class="form-field toggle-field">
                <label class="field-label">Active</label>
                <button class="toggle-btn @(IsActive ? "active" : "")" @onclick="() => IsActive = !IsActive">
                    <span class="toggle-track">
                        <span class="toggle-thumb"></span>
                    </span>
                    <span class="toggle-label">@(IsActive ? "Active" : "Paused")</span>
                </button>
            </div>
        }
    </div>

    <!-- Save Button -->
    <div class="save-section">
        <button class="save-btn @(!IsValid ? "disabled" : "")" 
                @onclick="Save" 
                disabled="@(!IsValid)">
            @(IsEditing ? "Update" : "Create") Recurring
        </button>
    </div>

    <ConfirmDialog IsVisible="ShowDeleteConfirm"
                   Title="Delete Recurring Transaction"
                   Message="Are you sure you want to delete this recurring transaction? Future auto-created transactions will stop."
                   ConfirmText="Delete"
                   IsDanger="true"
                   OnConfirm="DeleteRecurring"
                   OnCancel="CancelDelete" />
</div>
