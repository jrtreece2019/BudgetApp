@page "/categories"

<PageTitle>Categories</PageTitle>

<div class="categories-page">
    <PageHeader Title="Categories" OnBack="GoBack" />

    <ExpandableSection Icon="ðŸ“Œ" Title="Fixed Expenses" Count="FixedCategories.Count"
                       CssClass="fixed" @bind-IsExpanded="FixedExpanded">
        <div class="category-list">
            @foreach (var category in FixedCategories)
            {
                <div class="category-item" @onclick="() => EditCategory(category)">
                    <div class="category-icon" style="background-color: @category.Color">
                        @category.Icon
                    </div>
                    <div class="category-info">
                        <span class="category-name">@category.Name</span>
                        <span class="category-budget">@category.DefaultBudget.ToString("C0")/month</span>
                    </div>
                    <span class="category-chevron">â€º</span>
                </div>
            }
            @if (FixedCategories.Count == 0)
            {
                <EmptyState Message="No fixed expense categories yet" />
            }
        </div>
    </ExpandableSection>

    <ExpandableSection Icon="ðŸŽ¯" Title="Discretionary" Count="DiscretionaryCategories.Count"
                       CssClass="discretionary" @bind-IsExpanded="DiscretionaryExpanded">
        <div class="category-list">
            @foreach (var category in DiscretionaryCategories)
            {
                <div class="category-item" @onclick="() => EditCategory(category)">
                    <div class="category-icon" style="background-color: @category.Color">
                        @category.Icon
                    </div>
                    <div class="category-info">
                        <span class="category-name">@category.Name</span>
                        <span class="category-budget">@category.DefaultBudget.ToString("C0")/month</span>
                    </div>
                    <span class="category-chevron">â€º</span>
                </div>
            }
            @if (DiscretionaryCategories.Count == 0)
            {
                <EmptyState Message="No discretionary categories yet" />
            }
        </div>
    </ExpandableSection>

    <ExpandableSection Icon="ðŸ“ˆ" Title="Savings & Investments" Count="SavingsCategories.Count"
                       CssClass="savings" @bind-IsExpanded="SavingsExpanded">
        <div class="category-list">
            @foreach (var category in SavingsCategories)
            {
                <div class="category-item" @onclick="() => EditCategory(category)">
                    <div class="category-icon" style="background-color: @category.Color">
                        @category.Icon
                    </div>
                    <div class="category-info">
                        <span class="category-name">@category.Name</span>
                        <span class="category-budget">@category.DefaultBudget.ToString("C0")/month</span>
                    </div>
                    <span class="category-chevron">â€º</span>
                </div>
            }
            @if (SavingsCategories.Count == 0)
            {
                <EmptyState Message="No savings categories yet" />
            }
        </div>
    </ExpandableSection>

    <div class="bottom-spacer"></div>

    <FloatingActionButton Label="Add Category" OnClick="AddCategory" />
</div>

<ModalBase IsVisible="ShowModal" OnClose="CloseModal" Title="@((IsEditingCategory ? "Edit" : "New") + " Category")">
    <Body>
        <div class="form-field">
            <label class="field-label">Type</label>
            <div class="type-toggle">
                <button type="button"
                        class="type-btn @(EditType == CategoryType.Fixed ? "selected" : "")"
                        @onclick="() => EditType = CategoryType.Fixed">
                    <span class="type-icon">ðŸ“Œ</span>
                    <span class="type-label">Fixed</span>
                </button>
                <button type="button"
                        class="type-btn @(EditType == CategoryType.Discretionary ? "selected" : "")"
                        @onclick="() => EditType = CategoryType.Discretionary">
                    <span class="type-icon">ðŸŽ¯</span>
                    <span class="type-label">Discretionary</span>
                </button>
                <button type="button"
                        class="type-btn @(EditType == CategoryType.Savings ? "selected" : "")"
                        @onclick="() => EditType = CategoryType.Savings">
                    <span class="type-icon">ðŸ“ˆ</span>
                    <span class="type-label">Savings</span>
                </button>
            </div>
            <span class="type-hint">
                @(EditType == CategoryType.Fixed
                    ? "Predictable, recurring expenses (rent, bills, insurance)"
                    : EditType == CategoryType.Discretionary
                        ? "Variable, optional spending (dining, entertainment, shopping)"
                        : "Savings and investments (401k, IRA, brokerage)")
            </span>
        </div>

        <div class="form-field">
            <label class="field-label">Name</label>
            <input type="text"
                   class="field-input"
                   placeholder="Category name"
                   @bind="EditName" />
        </div>

        <div class="form-field">
            <label class="field-label">Icon</label>
            <IconPicker Options="IconOptions" @bind-SelectedValue="EditIcon" HighlightColor="@EditColor" />
        </div>

        <div class="form-field">
            <label class="field-label">Color</label>
            <ColorPicker Options="ColorOptions" @bind-SelectedValue="EditColor" />
        </div>

        <div class="form-field">
            <label class="field-label">Default Monthly Budget</label>
            <div class="budget-input-wrapper">
                <span class="currency-symbol">$</span>
                <input type="number"
                       class="field-input budget-field"
                       placeholder="0"
                       step="1"
                       min="0"
                       @bind="EditDefaultBudget" />
            </div>
            <span class="field-hint">This amount applies to all months unless you set a custom budget.</span>
        </div>

        <div class="form-field">
            <label class="field-label">Preview</label>
            <div class="preview-item">
                <div class="preview-icon" style="background-color: @EditColor">
                    @EditIcon
                </div>
                <div class="preview-details">
                    <span class="preview-name">@(string.IsNullOrEmpty(EditName) ? "Category Name" : EditName)</span>
                    <span class="preview-budget">@EditDefaultBudget.ToString("C0")/month</span>
                </div>
            </div>
        </div>
    </Body>
    <Footer>
        @if (IsEditingCategory && CanDelete)
        {
            <button class="delete-category-btn" @onclick="ConfirmDeleteCategory">Delete</button>
        }
        <button class="save-category-btn @(!IsModalValid ? "disabled" : "")"
                @onclick="SaveCategory"
                disabled="@(!IsModalValid)">
            @(IsEditingCategory ? "Update" : "Create")
        </button>
    </Footer>
</ModalBase>

<ConfirmDialog IsVisible="ShowDeleteConfirm"
               Title="Delete Category"
               Message="Are you sure you want to delete this category? This cannot be undone."
               ConfirmText="Delete"
               IsDanger="true"
               OnConfirm="DeleteCurrentCategory"
               OnCancel="CancelDelete" />
